<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thư Cho Em</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Indie+Flower&display=swap" rel="stylesheet">
  <style>
    /* Global box-sizing for consistent layout */
    html {
      box-sizing: border-box;
      scroll-behavior: smooth;
    }

    *,
    *::before,
    *::after {
      box-sizing: inherit;
    }

    :root {
      --vintage-paper: #fdf6e3;
      --vintage-text: #4b3e2e;
      --vintage-accent: #a47149;
      --vintage-dark: #6e4e37;
      --shadow-light: rgba(0, 0, 0, 0.1);
      --shadow-dark: rgba(0, 0, 0, 0.2);
      /* Màu sắc cho ghi chú dễ thương */
      --cute-pink: #f7cac9;
      --cute-green: #d4f8e8;
      --cute-blue: #c9e9f7;
      --cute-border: #f7b2bd;
      --cute-text: #6e4e37;
    }

    body {
      /* Font chữ chính cho body là Indie Flower (viết tay, dễ đọc) */
      font-family: 'Indie Flower', cursive;
      margin: 0;
      padding: 0;
      background: var(--vintage-paper);
      color: var(--vintage-text);
      position: relative;
      overflow-x: hidden;
      background-attachment: fixed;
      background-image: url('https://png.pngtree.com/background/20210715/original/pngtree-literary-and-artistic-small-fresh-antique-ink-smudge-cherry-letterhead-original-picture-image_1298684.jpg');
      background-size: cover;
      background-position: center;
    }

    header {
      background: var(--vintage-dark);
      color: white;
      text-align: center;
      padding: 2rem 1rem;
      box-shadow: 0 4px 8px var(--shadow-dark);
      position: sticky;
      top: 0;
      z-index: 1000;
      font-family: 'Playfair Display', serif;
      border-bottom: 2px solid var(--vintage-accent);
    }

    header h1 {
      margin: 0;
      font-size: 3rem;
      letter-spacing: 2px;
      text-shadow: 2px 2px 5px var(--shadow-dark);
      position: relative;
      display: inline-block;
    }

    header h1::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 3px;
      background-color: var(--vintage-accent);
      border-radius: 5px;
    }

    /* CSS cho Khung đĩa nhạc xoay */
    .music-player-widget {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      background-color: rgba(255, 255, 255, 0.8);
      padding: 0.8rem 1.5rem;
      margin: 20px auto;
      max-width: 450px;
      border-radius: 10px;
      box-shadow: 0 5px 15px var(--shadow-light);
      border: 1px solid var(--vintage-accent);
    }

    .vinyl-disc {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.1),
                  inset 0 0 0 2px var(--vintage-dark);
      animation: spin 10s linear infinite;
      flex-shrink: 0;
    }

    .vinyl-disc img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      border-radius: 50%;
      opacity: 1;
      transform: none;
      margin: 0;
      box-shadow: none;
      border: none;
      padding: 0;
      background-color: transparent;
    }

    .vinyl-hole {
      width: 16px;
      height: 16px;
      background-color: var(--vintage-dark);
      border-radius: 50%;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border: 2px solid white;
      box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
    }

    .song-info {
      font-family: 'Playfair Display', serif;
      color: var(--vintage-dark);
      text-align: left;
      flex-grow: 1;
      min-width: 0;
    }

    .song-info h3 {
      margin: 0;
      font-size: 1.3rem;
      color: var(--vintage-accent);
      text-shadow: 1px 1px 2px var(--shadow-light);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .song-info p {
      margin: 0.3rem 0 0 0;
      font-size: 0.9rem;
      color: var(--vintage-text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    @keyframes spin {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }

    main {
      max-width: 850px;
      margin: 40px auto;
      padding: 2rem 1rem;
      line-height: 1.8;
      position: relative;
      z-index: 1;
      background: var(--vintage-paper);
      border: 1px solid #d4c09d;
      box-shadow: 0 10px 20px var(--shadow-dark);
      border-radius: 5px;
      padding-bottom: 12rem;
    }

    main::before,
    main::after {
      content: '';
      position: absolute;
      width: 50px;
      height: 50px;
      background-color: var(--vintage-text);
      clip-path: polygon(0 0, 100% 0, 0 100%);
      opacity: 0.05;
      z-index: 0;
    }

    main::before {
      top: 0;
      left: 0;
      transform: rotate(180deg);
    }

    main::after {
      bottom: 0;
      right: 0;
    }

    /* Điều chỉnh CSS cho thẻ img chung */
    img {
      width: 100%;
      height: auto; /* Chiều cao tự động theo tỷ lệ */
      object-fit: contain; /* Đảm bảo toàn bộ ảnh hiển thị, có thể có khoảng trắng */
      /* max-height: none; */ /* Bỏ giới hạn chiều cao tối đa nếu muốn ảnh hiển thị đầy đủ */
      border-radius: 5px;
      box-shadow: 0 4px 12px var(--shadow-light);
      transition: transform 1.0s ease, opacity 0.4s ease;
      opacity: 0; /* Mặc định ẩn để dùng hiệu ứng reveal */
      transform: translateY(40px);
      margin: 2rem 0;
      border: 3px solid var(--vintage-accent);
      padding: 5px;
      background-color: white;
    }

    img.visible {
      opacity: 1;
      transform: translateY(0);
    }

    section {
      margin-bottom: 3rem;
      padding: 1.5rem;
      border: 1px dashed var(--vintage-accent);
      background-color: rgba(255, 255, 255, 0.7);
      border-radius: 5px;
      position: relative;
      z-index: 1;
    }

    section:not(:last-child) {
        margin-top: 2.5rem;
      margin-bottom: 4rem;
    }

    section h2 {
      font-family: 'Playfair Display', serif;
      font-size: 2rem;
      color: var(--vintage-dark);
      text-align: center;
      margin-bottom: 1.5rem;
      position: relative;
      padding-bottom: 10px;
    }

    section h2::before,
    section h2::after {
      content: '';
      position: absolute;
      font-size: 1.2rem;
      color: var(--vintage-accent);
      top: 50%;
      transform: translateY(-50%);
    }

    section h2::before {
      left: 0;
    }

    section h2::after {
      right: 0;
    }

    section p {
      font-size: 1.2rem;
      line-height: 1.8;
      text-align: justify;
      hyphens: auto;
    }

    button {
      background-color: var(--vintage-accent);
      color: white;
      border: none;
      padding: 1rem 2.2rem;
      border-radius: 30px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
      font-family: 'Playfair Display', serif;
      box-shadow: 0 4px 8px var(--shadow-light);
      letter-spacing: 0.5px;
    }

    button:hover {
      background-color: var(--vintage-dark);
      transform: translateY(-3px);
      box-shadow: 0 6px 12px var(--shadow-dark);
    }

    .stamp {
      position: absolute;
      width: 80px;
      height: 80px;
      background-image: url('https://media.istockphoto.com/id/1214700549/vi/vec-to/mèo-in-chân-chó-dấu-vết-thú-cưng-chó-con-phong-cách-phẳng-vectơ-chứng-khoán.jpg?s=612x612&w=0&k=20&c=ibZl34XsVAzbZwuxlET-Jhzy8sF_ay0n20ZXEzPslcU=');
      background-size: contain;
      background-repeat: no-repeat;
      opacity: 0.1;
      transform: rotate(15deg);
      pointer-events: none;
      z-index: 2;
    }

    .stamp-top-right {
      top: 10px;
      right: 10px;
    }

    .stamp-bottom-left {
      bottom: 10px;
      left: 10px;
      transform: rotate(-25deg);
    }

    section h2 span,
    section p span {
      display: block;
    }

    section.in-view h2 span {
      animation: reveal-text-clip 2.5s ease-in-out forwards 0s;
    }

    section.in-view p span {
      animation: reveal-text-clip 2s ease-in-out forwards 0.4s;
    }

    @keyframes reveal-text-clip {
      from {
        clip-path: inset(0 100% 0 0);
      }
      to {
        clip-path: inset(0 0% 0 0);
      }
    }

    /* CSS cho Carousel ảnh - Đã cập nhật */
    .image-carousel-section {
      overflow: hidden;
      padding: 1.5rem;
      border: 1px dashed var(--vintage-accent);
      background-color: rgba(255, 255, 255, 0.7);
      border-radius: 5px;
      position: relative;
      z-index: 1;
    }

    .image-carousel {
      width: 100%;
      margin: 4rem auto 1rem auto; /* Điều chỉnh margin bottom để tạo không gian cho dots */
      position: relative;
      overflow: hidden;
      border: 5px solid var(--vintage-dark);
      border-radius: 10px;
      box-shadow: 0 8px 16px var(--shadow-dark);
      background-color: var(--vintage-paper);
      padding: 10px;
      cursor: grab;
      height: 450px;
      display: flex; /* Giữ nguyên flex để kéo ảnh */
      align-items: center;
    }

    .image-carousel:active {
      cursor: grabbing;
    }

    .carousel-inner {
      display: flex;
      height: 100%;
      will-change: transform;
      transition: transform 0.5s ease-in-out; /* Đảm bảo transition cho việc chuyển slide */
      /* Tính toán lại width để bù cho padding của .carousel-item */
      width: calc(100% * var(--total-carousel-items));
    }

    .carousel-item {
      min-width: 100%; /* Mỗi item chiếm 100% chiều rộng của carousel */
      height: 100%;
      display: flex;
      justify-content: center; /* Căn giữa theo chiều ngang */
      align-items: center; /* Căn giữa theo chiều dọc */
      flex-shrink: 0; /* Quan trọng: Ngăn không cho các item bị co lại */
      padding-left: 10px; /* Thêm khoảng cách bên trái */
      padding-right: 10px; /* Thêm khoảng cách bên phải */
      box-sizing: border-box; /* Đảm bảo padding không làm tăng kích thước tổng của item */
    }

    .carousel-item img {
      width: 100%;
      height: 100%;
      object-fit: contain; /* Đảm bảo toàn bộ ảnh hiển thị, thêm khoảng trắng nếu cần */
      display: block;
      border: 3px solid var(--vintage-accent);
      padding: 5px;
      background-color: white;
      margin: 0;
      opacity: 1; /* Luôn visible */
      transform: none; /* Bỏ transform để không xung đột */
      box-shadow: 0 2px 8px var(--shadow-light);
    }

    /* CSS CHO CÁC DẤU CHẤM */
    .carousel-indicators {
      display: flex;
      justify-content: center;
      margin-top: 1.5rem; /* Khoảng cách từ carousel */
      margin-bottom: 1.5rem; /* Khoảng cách tới đoạn văn bản */
    }

    .indicator-dot {
      width: 10px;
      height: 10px;
      background-color: var(--vintage-accent);
      border-radius: 50%;
      margin: 0 5px;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.2s ease;
      opacity: 0.5; /* Mờ hơn khi không active */
    }

    .indicator-dot.active {
      background-color: var(--vintage-dark);
      opacity: 1;
      transform: scale(1.2); /* Phóng to hơn khi active */
    }

    /* Lớp phủ hướng dẫn MỚI VỚI HIỆU ỨNG MŨI TÊN */
    .carousel-fade {
        position: absolute;
        top: 0;
        height: 100%;
        width: 80px;
        pointer-events: none;
        z-index: 11;
        opacity: 0; /* Mặc định ẩn */
        transition: opacity 0.5s ease-in-out;
        display: flex; /* Dùng flex để căn giữa mũi tên */
        align-items: center; /* Căn giữa theo chiều dọc */
        justify-content: center; /* Căn giữa theo chiều ngang (cho mũi tên) */
    }

    .carousel-fade.active {
        opacity: 1; /* Hiện ra khi có class active */
    }

    .carousel-fade.left {
        left: 0;
        background: linear-gradient(to right, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0));
    }

    .carousel-fade.right {
        right: 0;
        background: linear-gradient(to left, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0));
    }

    /* Tạo 3 mũi tên nhỏ */
    .carousel-fade::before,
    .carousel-fade::after {
        content: '';
        position: absolute;
        width: 0;
        height: 0;
        border-style: solid;
        top: 50%;
        transform: translateY(-50%);
        opacity: 0; /* Ban đầu ẩn */
        animation-timing-function: ease-out; /* Hiệu ứng mượt hơn */
    }

    /* Mũi tên bên trái */
    .carousel-fade.left::before {
        border-width: 10px 10px 10px 0; /* Kích thước mũi tên */
        border-color: transparent var(--vintage-dark) transparent transparent; /* Màu mũi tên */
        right: 15px; /* Vị trí mũi tên đầu tiên */
        animation: slideInLeft 1.5s infinite; /* Animation */
    }

    .carousel-fade.left::after { /* Mũi tên thứ hai và thứ ba (dùng ::after) */
        border-width: 10px 10px 10px 0;
        border-color: transparent var(--vintage-dark) transparent transparent;
        right: 30px; /* Vị trí mũi tên thứ hai */
        animation: slideInLeft 1.5s infinite 0.3s; /* Delay 0.3s */
    }

    /* Mũi tên bên phải */
    .carousel-fade.right::before {
        border-width: 10px 0 10px 10px;
        border-color: transparent transparent transparent var(--vintage-dark);
        left: 15px;
        animation: slideInRight 1.5s infinite;
    }

    .carousel-fade.right::after {
        border-width: 10px 0 10px 10px;
        border-color: transparent transparent transparent var(--vintage-dark);
        left: 30px;
        animation: slideInRight 1.5s infinite 0.3s;
    }

    /* Keyframes cho hiệu ứng mũi tên */
    @keyframes slideInLeft {
        0% { opacity: 0; transform: translateY(-50%) translateX(20px); }
        50% { opacity: 0.8; transform: translateY(-50%) translateX(0); }
        100% { opacity: 0; transform: translateY(-50%) translateX(-20px); }
    }

    @keyframes slideInRight {
        0% { opacity: 0; transform: translateY(-50%) translateX(-20px); }
        50% { opacity: 0.8; transform: translateY(-50%) translateX(0); }
        100% { opacity: 0; transform: translateY(-50%) translateX(20px); }
    }

    /* Ẩn mũi tên và lớp phủ nếu chỉ có 1 ảnh */
    .image-carousel-section:has(.carousel-item:only-child) .carousel-fade,
    .image-carousel-section:has(.carousel-item:only-child) .carousel-indicators {
        display: none;
    }


    /* CSS cho Animated Sticker */
    .animated-sticker {
      width: 80px;
      height: 80px;
      margin: 1rem auto;
      display: block;
    }

    /* CSS cho Video Section */
    .video-section {
      text-align: center;
      padding: 2rem 1.5rem;
      margin-top: 4rem;
      border: 1px dashed var(--vintage-accent);
      background-color: rgba(255, 255, 255, 0.7);
      border-radius: 5px;
      overflow: hidden;
    }

    .video-container {
      position: relative;
      width: 100%;
      margin: 2rem auto;
      border: 5px solid var(--vintage-dark);
      border-radius: 10px;
      box-shadow: 0 8px 16px var(--shadow-dark);
      overflow: visible;
    }

    .video-container video {
      display: block;
      width: 100%;
      height: auto;
      object-fit: contain;
      pointer-events: none;
      border-radius: 5px;
    }

    /* CSS cho Chữ ký */
    .signature-block {
      position: absolute;
      bottom: 8rem;
      right: 2rem;
      text-align: right;
      /* Font chữ viết tay cho chữ ký */
      font-family: 'Indie Flower', cursive;
      font-size: 1.5rem;
      color: var(--vintage-dark);
      line-height: 1.2;
      z-index: 2;
      white-space: nowrap;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    }

    .signature-block.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .signature-block p {
      margin: 0;
    }

    .signature-name {
      font-family: 'Playfair Display', serif;
      font-size: 1.8rem;
      font-weight: bold;
      color: var(--vintage-accent);
      text-shadow: 1px 1px 2px var(--shadow-light);
    }

    /* CSS MỚI cho phần Ghi chú */
    .notes-section-cute {
      max-width: 300px;
      margin: 4rem auto 2rem auto;
      padding: 1.5rem;
      background-color: var(--cute-pink);
      border: 3px solid var(--cute-border);
      border-radius: 15px 50px 15px 50px / 50px 15px 50px 15px;
      box-shadow: 5px 5px 15px var(--shadow-dark);
      text-align: center;
      /* Font chữ viết tay cho phần ghi chú */
      font-family: 'Indie Flower', cursive;
      color: var(--cute-text);
      line-height: 1.5;
      font-size: 1.1rem;
      position: relative;
      z-index: 1;
      opacity: 0;
      transform: scale(0.9) translateY(30px);
      transition: opacity 0.8s ease-out, transform 0.8s ease-out;
    }

    .notes-section-cute.visible {
      opacity: 1;
      transform: scale(1) translateY(0);
    }

    .notes-section-cute h3 {
      font-family: 'Playfair Display', serif;
      font-size: 1.5rem;
      color: var(--vintage-dark);
      margin-top: 0;
      margin-bottom: 1rem;
      position: relative;
    }

    .notes-section-cute h3::after {
      content: '♡';
      color: var(--cute-border);
      position: absolute;
      right: -15px;
      bottom: -5px;
      font-size: 1.2rem;
    }

    .notes-section-cute p {
      margin-bottom: 0.8rem;
      text-align: center;
    }

    .notes-section-cute p:last-child {
      margin-bottom: 0;
    }

    /* Điều chỉnh Responsive */
    @media (max-width: 600px) {
      header h1 {
        font-size: 2.2rem;
      }

      /* Điều chỉnh Responsive cho Khung đĩa nhạc */
      .music-player-widget {
        flex-direction: column; /* Xếp đĩa và thông tin theo cột trên di động */
        gap: 0.8rem; /* Giảm khoảng cách */
        padding: 0.8rem;
        max-width: 90%;
      }

      .vinyl-disc {
        width: 70px; /* Thu nhỏ hơn nữa trên di động */
        height: 70px; /* Thu nhỏ hơn nữa trên di động */
      }

      .vinyl-hole {
        width: 14px;
        height: 14px;
      }

      .song-info {
        text-align: center; /* Căn giữa thông tin khi xếp cột */
      }

      .song-info h3 {
        font-size: 1.2rem; /* Thu nhỏ font tiêu đề */
      }

      .song-info p {
        font-size: 0.85rem; /* Thu nhỏ font nội dung */
      }

      main {
        margin: 20px auto;
        padding: 1rem;
        padding-bottom: 10rem;
      }

      section {
        padding: 1rem;
      }

      section h2 {
        font-size: 1.8rem;
      }

      section p {
        font-size: 1rem;
      }

      button {
        padding: 0.8rem 1.5rem;
        font-size: 1rem;
      }

      .image-carousel {
        margin: 2rem auto;
        height: 300px;
      }

      .carousel-item img {
        padding: 3px;
      }

      .carousel-fade {
        width: 30px;
      }

      .video-section {
        padding: 1rem;
        margin-top: 3rem;
      }

      .signature-block {
        right: 1rem;
        font-size: 1.2rem;
        bottom: 6rem;
      }

      .signature-name {
        font-size: 1.5rem;
      }

      .notes-section-cute {
        max-width: calc(100% - 2rem);
        padding: 1rem;
        font-size: 1rem;
        margin: 2rem auto 1rem auto;
        border-radius: 10px 30px 10px 30px / 30px 10px 30px 10px;
      }

      .notes-section-cute h3 {
        font-size: 1.3rem;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1><span id="typewriter-text"></span></h1>
  </header>

  <div class="music-player-widget">
    <div class="vinyl-disc">
      <img src="https://avatar-ex-swe.nixcdn.com/song/2025/02/21/E/M/I/X/1740151379142_640.jpg" alt="Đĩa nhạc">
      <div class="vinyl-hole"></div>
    </div>
    <div class="song-info">
      <h3>Phép màu</h3>
      <p>Đừng quên bật nhạc nháa</p>
    </div>
  </div>

  <main>
    <div class="stamp stamp-top-right"></div>
    <div class="stamp stamp-bottom-left"></div>

    <section>
      <h2><span>Gửi bé iu của anh</span></h2>
      <p><span>Nhân dịp sinh nhật này, anh muốn tặng em một món quà độc nhất trên thế giớii cho người đáng iu nhất thế giớii.
         Đây là lần đầu tiên chúng ta đón sinh nhật cùng nhau nên anh muốn tạo một bất ngờ cho em, dù có hơi xấu nhưng mà em hãy hoan hỉ nhé hihi :3 
        </span></p>
      <img src="./VidAndImg/em3.jpg" alt="Sáng vintage" />
    </section>

    <section>
      <h2><span>Đôi lời của anh</span></h2>
      <p><span>Hi bé iu, vậy là đã được nửa năm chính thức chúng ta ở bên nhau. 
        Anh cảm ơn em vì suốt khoảng thời gian qua đã luôn ở bên cạnh anh.
        Anh xin lỗi vì anh đã làm em buồn cũng khá nhiều lần, nhưng mong em hãy bỏ qua cho anh nhé vì anh cũng đang học cách phát triển để yêu em hơn.
        Anh biết anh không tinh tế, đẹp trai, tài giỏi như người khác và đôi lúc cũng cục súc nữa.
        Anh sẽ có gắng hoàn thiện bản thân hơn từng ngày để có thể cùng em đi con đường dài nhất có thể.
        Anh trân trọng những giây phút bên nhau, em là cô gái đầu tiên và sẽ mãi là người anh yêu nhất.
        Nếu có điều gì cần anh thay đổi thì em cứ nói cho anh biết nhé, ví dụ như anh bín thái quá, ...v...v..😜
        Ngoài ra anh cũng muốn nhắn nhủ em phải biết giữ sức khỏe, đừng thức khuya nhìu quá mà hại sức khỏe đấy nhá, ra đường nhớ mang áo chống nắng, trùm kín,
        và quan trọng là phải yêu anh nhìu hơn nữa nhaaa 😘.
        Bất cứ khi nào em cần hãy cho anh nha biết nhé, anh sẽ ở bên cạnh em bất cứ lúc nào em cần.
      </span>
    <span>
        Anh muốn trang web này sẽ là nơi lưu giữ những kỷ niệm đẹp của chúng ta cho cả hiện tại và sau này, nếu có góp ý gì cứ cho anh biết nhé.
        Iu em nhìu lém, bé iu của anhh 💖
    </span>
    </p>
      <img src="./VidAndImg/em5.JPG" alt="Cafe vintage" />
    </section>

    <section class="image-carousel-section">
      <h2><span>Khoảnh khắc cùng nhau nèe</span></h2>
      <div class="image-carousel">
        <div class="carousel-inner">
          <div class="carousel-item">
            <img src="./VidAndImg/together4.JPG" alt="Ảnh Vintage 1">
          </div>
          <div class="carousel-item">
            <img src="./VidAndImg/together5.JPG" alt="Ảnh Vintage 2">
          </div>
          <div class="carousel-item">
            <img src="./VidAndImg/together6.JPG" alt="Ảnh Vintage 3">
          </div>
          <div class="carousel-item">
            <img src="./VidAndImg/Together1.JPG" alt="Ảnh Vintage 4">
          </div>
          <div class="carousel-item">
            <img src="./VidAndImg/together3.JPG" alt="Ảnh Vintage 5">
          </div>
        </div>
        <div class="carousel-fade left"></div>
        <div class="carousel-fade right"></div>
      </div>
      <div class="carousel-indicators">
        </div>
      <p style="text-align: center;"><span>Những bức ảnh cũ luôn mang theo một câu chuyện riêng, một phần của dòng thời gian đã trôi qua.</span></p>
    </section>



    <section class="video-section">
      <h2><span>Video photobooth nìa</span></h2>
      <div class="video-container">
        <video id="backgroundVideo" src="./VidAndImg/ptbVid1.MOV" loop muted playsinline preload="auto"></video>
      </div>
      <p><span>Một khoảnh khắc tĩnh lặng, tái hiện lại vẻ đẹp của thời gian.</span></p>
    </section>

    <div class="signature-block">
      <p>Chúc em sinh nhật vui vẻ!</p>
      <p class="signature-name">Anh cún 🐾</p>
      <p>Iu em 💝</p>
    </div>

    <div class="notes-section-cute">
      <h3>Ghi chú nhỏ !</h3>
      <p>Chỉ ai có tấm thẻ mới vào được web này thoiii hihi :3</p>
    </div>
  </main>

  <audio id="background-music" loop autoplay>
    <source src="./VidAndImg/Phep_mau.mp3" type="audio/mpeg">
    Trình duyệt của bạn không hỗ trợ phát nhạc.
  </audio>

  <script>
    const images = document.querySelectorAll('img');

    const imgObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          imgObserver.unobserve(entry.target);
        }
      });
    }, {
      threshold: 1.0
    });

    // Chỉ quan sát ảnh trong các section không phải carousel
    document.querySelectorAll('section:not(.image-carousel-section) img').forEach(img => imgObserver.observe(img));

    const sections = document.querySelectorAll('section');

    const sectionObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('in-view');
          sectionObserver.unobserve(entry.target);
        }
      });
    }, {
      threshold: 0.7
    });

    sections.forEach(section => sectionObserver.observe(section));

    // Script hiệu ứng typewriter
    const textElement = document.getElementById('typewriter-text');
    const text = "💌 Thư cho em 💌";
    let i = 0;
    let typeWriterDelay = 120; // Đổi tên biến để tránh trùng lặp

    function typeWriter() {
      if (i <= text.length) { // Chỉnh sửa điều kiện vòng lặp
        textElement.textContent = text.substring(0, i);
        i++;
        setTimeout(typeWriter, typeWriterDelay);
      }
    }

    // Chạy typewriter khi DOM đã tải xong
    document.addEventListener('DOMContentLoaded', typeWriter);


    // Logic cho Carousel ảnh ĐÃ CẬP NHẬT HOÀN TOÀN
    const carousel = document.querySelector('.image-carousel');
    const carouselInner = document.querySelector('.carousel-inner');
    const carouselItems = document.querySelectorAll('.carousel-item');
    const totalItems = carouselItems.length;
    const carouselIndicatorsContainer = document.querySelector('.carousel-indicators');

    // Thiết lập biến CSS để tính toán chiều rộng của carousel-inner
    carouselInner.style.setProperty('--total-carousel-items', totalItems);

    // Thêm biến cho lớp phủ hướng dẫn
    const carouselFadeLeft = document.querySelector('.carousel-fade.left');
    const carouselFadeRight = document.querySelector('.carousel-fade.right');

    let currentIndex = 0;
    let autoSlideInterval = null;
    const slideDuration = 3000; // Thời gian chuyển ảnh tự động (ms)
    let inactivityTimer = null; // Timer cho việc hiển thị lại mũi tên
    const indicatorFadeDelay = 5000; // Thời gian không hoạt động trước khi hiển thị lại mũi tên (ms)

    let isDragging = false;
    let startPos = 0;
    let currentTranslate = 0;
    let prevTranslate = 0;
    let animationId; // Biến để quản lý requestAnimationFrame

    // Tạo các dấu chấm chỉ thị
    function createIndicatorDots() {
      carouselIndicatorsContainer.innerHTML = ''; // Xóa các chấm cũ (nếu có)
      if (totalItems > 1) { // Chỉ tạo dấu chấm nếu có nhiều hơn 1 ảnh
        for (let i = 0; i < totalItems; i++) {
          const dot = document.createElement('div');
          dot.classList.add('indicator-dot');
          dot.dataset.index = i;
          dot.addEventListener('click', () => {
            currentIndex = i;
            updateCarousel(true); // Truyền true để báo hiệu là tương tác người dùng
          });
          carouselIndicatorsContainer.appendChild(dot);
        }
        updateIndicatorDots();
        // Không gọi showFadeEffect() ở đây, sẽ gọi qua timer nếu không có tương tác
      } else {
        hideFadeEffect(); // Ẩn hiệu ứng mờ/mũi tên nếu chỉ có 1 ảnh
      }
    }

    // Cập nhật trạng thái active của dấu chấm
    function updateIndicatorDots() {
      document.querySelectorAll('.indicator-dot').forEach((dot, index) => {
        if (index === currentIndex) {
          dot.classList.add('active');
        } else {
          dot.classList.remove('active');
        }
      });
    }

    // Lấy vị trí X của con trỏ/ngón tay
    function getPositionX(event) {
      return event.type.includes('touch') ? event.touches[0].clientX : event.clientX;
    }

    // Cập nhật vị trí transform của carousel
    function setSliderTransform() {
      carouselInner.style.transform = `translateX(${currentTranslate}px)`;
    }

    // Cập nhật toàn bộ trạng thái carousel (vị trí ảnh, dấu chấm, hẹn giờ)
    // Thêm tham số `isUserInteraction` để kiểm soát hiển thị mũi tên
    function updateCarousel(isUserInteraction = false) {
      // Lấy chiều rộng thực tế của một carousel-item, bao gồm cả padding
      const itemWidth = carouselItems[0].offsetWidth; // Lấy chiều rộng của item đầu tiên
      currentTranslate = currentIndex * -itemWidth;

      setSliderTransform();
      updateIndicatorDots(); // Cập nhật dấu chấm mỗi khi chuyển ảnh
      resetAutoSlideTimer(); // Đặt lại bộ hẹn giờ tự động chạy slide

      // Chỉ reset và ẩn mũi tên nếu là tương tác người dùng
      if (isUserInteraction) {
        resetIndicatorFadeTimer();
      }
    }

    // Di chuyển slide theo hướng (1 cho tiếp theo, -1 cho trước đó)
    function moveSlide(direction) {
      currentIndex = (currentIndex + direction + totalItems) % totalItems;
      updateCarousel(false); // isUserInteraction = false khi tự động chạy
    }

    // Bắt đầu chế độ tự động chạy slide
    function startAutoSlide() {
      if (autoSlideInterval) {
        clearInterval(autoSlideInterval);
      }
      if (totalItems > 1) { // Chỉ tự động chạy nếu có nhiều hơn 1 ảnh
        autoSlideInterval = setInterval(() => {
          moveSlide(1);
        }, slideDuration);
      }
    }

    // Dừng chế độ tự động chạy slide
    function stopAutoSlide() {
      if (autoSlideInterval) {
        clearInterval(autoSlideInterval);
        autoSlideInterval = null;
      }
    }

    // Đặt lại bộ hẹn giờ tự động chạy khi có tương tác (áp dụng cho slide tự động)
    function resetAutoSlideTimer() {
      stopAutoSlide();
      // Chúng ta sẽ dùng inactivityTimer để kích hoạt lại autoSlide
      clearTimeout(inactivityTimer);
      inactivityTimer = setTimeout(() => {
        startAutoSlide();
        showFadeEffect(); // Sau 5s không tương tác, hiển thị mũi tên
      }, indicatorFadeDelay); // Dùng cùng delay với mũi tên để đồng bộ
    }

    // Reset timer hiển thị mũi tên hướng dẫn (chỉ khi người dùng tương tác)
    function resetIndicatorFadeTimer() {
        clearTimeout(inactivityTimer); // Xóa timer hiện tại (bao gồm cả auto slide)
        hideFadeEffect(); // Ẩn ngay lập tức khi có tương tác
        if (totalItems > 1) {
            inactivityTimer = setTimeout(() => {
                showFadeEffect(); // Hiển thị lại sau delay nếu không có tương tác nào nữa
                startAutoSlide(); // Khởi động lại auto slide
            }, indicatorFadeDelay);
        }
    }


    // Hiển thị lớp phủ hướng dẫn
    function showFadeEffect() {
        if (totalItems > 1) { // Chỉ hiển thị nếu có nhiều hơn 1 ảnh
            carouselFadeLeft.classList.add('active');
            carouselFadeRight.classList.add('active');
        }
    }

    // Ẩn lớp phủ hướng dẫn
    function hideFadeEffect() {
        carouselFadeLeft.classList.remove('active');
        carouselFadeRight.classList.remove('active');
    }


    // --- Kéo/Vuốt ảnh ---
    carousel.addEventListener('mousedown', dragStart);
    carousel.addEventListener('mouseup', dragEnd);
    carousel.addEventListener('mouseleave', dragEnd);
    carousel.addEventListener('mousemove', drag);

    carousel.addEventListener('touchstart', dragStart);
    carousel.addEventListener('touchend', dragEnd);
    carousel.addEventListener('touchmove', drag);

    function dragStart(event) {
      carouselInner.style.transition = 'none'; // Tắt transition khi bắt đầu kéo để mượt mà
      stopAutoSlide(); // Dừng tự động chạy khi kéo
      hideFadeEffect(); // Ẩn mũi tên ngay lập tức khi bắt đầu kéo

      isDragging = true;
      startPos = getPositionX(event);
      prevTranslate = currentTranslate; // Lưu lại vị trí hiện tại trước khi kéo

      if (event.type === 'mousedown') {
        event.preventDefault(); // Ngăn kéo ảnh bị lỗi trên desktop
      }
      animationId = requestAnimationFrame(animation); // Bắt đầu vòng lặp animation cho kéo
    }

    function animation() {
      setSliderTransform(); // Cập nhật vị trí ảnh liên tục
      if (isDragging) {
        requestAnimationFrame(animation);
      }
    }

    function drag(event) {
      if (!isDragging) return;

      const currentPosition = getPositionX(event);
      const diff = currentPosition - startPos; // Khoảng cách đã kéo
      currentTranslate = prevTranslate + diff; // Vị trí mới dựa trên kéo
    }

    function dragEnd() {
      cancelAnimationFrame(animationId); // Dừng vòng lặp animation
      isDragging = false;
      carouselInner.style.transition = 'transform 0.5s ease-in-out'; // Bật lại transition cho chuyển động mượt

      const movedBy = currentTranslate - prevTranslate; // Tổng khoảng cách đã di chuyển
      // Lấy chiều rộng thực tế của một carousel item
      const itemWidth = carouselItems[0].offsetWidth;

      // Xác định slide mới dựa trên quãng đường kéo (lớn hơn 1/4 chiều rộng slide thì chuyển)
      if (movedBy < -itemWidth / 4) { // Kéo sang trái đủ xa -> chuyển slide tiếp theo
        currentIndex = (currentIndex + 1 + totalItems) % totalItems;
      } else if (movedBy > itemWidth / 4) { // Kéo sang phải đủ xa -> chuyển slide trước đó
        currentIndex = (currentIndex - 1 + totalItems) % totalItems;
      }

      updateCarousel(true); // Gọi updateCarousel với isUserInteraction = true
    }

    // Xử lý khi cửa sổ thay đổi kích thước để carousel không bị lỗi hiển thị
    window.addEventListener('resize', () => {
      carouselInner.style.transition = 'none'; // Tắt transition khi resize để tránh giật
      updateCarousel(false); // Gọi updateCarousel nhưng không coi là tương tác người dùng
      // Sau khi resize, đặt lại timer để mũi tên hiển thị lại nếu không có tương tác
      if (totalItems > 1) {
          resetIndicatorFadeTimer();
      } else {
          hideFadeEffect();
      }
    });

    document.addEventListener('DOMContentLoaded', () => {
      createIndicatorDots(); // Tạo các chấm khi DOM tải xong
      updateCarousel(false); // Cập nhật vị trí ảnh ban đầu (không phải tương tác người dùng)
      resetAutoSlideTimer(); // Bắt đầu hẹn giờ tự động chạy slide
    });

    // --- Logic cho Video tự động phát khi cuộn đến ---
    const videoElement = document.getElementById('backgroundVideo');

    const videoObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          videoElement.play().catch(error => {
            // console.error("Error attempting to play video:", error);
          });
        } else {
          videoElement.pause();
        }
      });
    }, {
      threshold: 0.5
    });

    // Bắt đầu quan sát video
    videoObserver.observe(videoElement);

    // --- Logic cho hiệu ứng xuất hiện chữ ký ---
    const signatureBlock = document.querySelector('.signature-block');
    const signatureObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          signatureBlock.classList.add('visible');
          signatureObserver.unobserve(entry.target);
        }
      });
    }, {
      threshold: 0.7
    });

    signatureObserver.observe(signatureBlock);

    // --- Logic cho hiệu ứng xuất hiện ghi chú dễ thương ---
    const cuteNotesSection = document.querySelector('.notes-section-cute');
    const cuteNotesObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          cuteNotesSection.classList.add('visible');
          cuteNotesObserver.unobserve(entry.target);
        }
      });
    }, {
      threshold: 0.7
    });

    cuteNotesObserver.observe(cuteNotesSection);

    // --- Logic cho nhạc nền ---
    document.addEventListener('DOMContentLoaded', function() {
      const audio = document.getElementById('background-music');

      audio.play().catch(error => {
        // console.log("Tự động phát nhạc bị chặn:", error);
        const musicToggleBtn = document.createElement('button');
        musicToggleBtn.textContent = '🎶 Bật/Tắt Nhạc 🎶';
        musicToggleBtn.style.position = 'fixed';
        musicToggleBtn.style.bottom = '20px';
        musicToggleBtn.style.left = '20px';
        musicToggleBtn.style.zIndex = '9999';
        musicToggleBtn.style.padding = '10px 15px';
        musicToggleBtn.style.backgroundColor = 'var(--vintage-accent)';
        musicToggleBtn.style.color = 'white';
        musicToggleBtn.style.border = 'none';
        musicToggleBtn.style.borderRadius = '5px';
        musicToggleBtn.style.cursor = 'pointer';
        musicToggleBtn.style.fontFamily = 'Playfair Display, serif';
        musicToggleBtn.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';


        document.body.appendChild(musicToggleBtn);

        musicToggleBtn.addEventListener('click', () => {
          if (audio.paused) {
            audio.play();
            musicToggleBtn.textContent = '🎶 Bật/Tắt Nhạc 🎶';
          } else {
            audio.pause();
            musicToggleBtn.textContent = '🔇 Bật/Tắt Nhạc 🔇';
          }
        });
      });
    });
  </script>
</body>

</html>